---
title: "Say yes"
author: juancarlospaco
excerpt: "Yes from coreutils rewritten in multiple popular languages"
---

"Yes" from Posix coreutils is a simple command line program that prints `"y"` usually found in Linux, BSD, OSX, etc.
We are going to explore reimplementing a basic "Yes" command in Nim, and other popular programming languages.

#### yes.nim

```nim
proc main() =
  while true:
    stdout.write 'y'
    stdout.write '\n'

when isMainModule:
  main()
```

#### yes.c

```c
#include <stdio.h>

int main(const char* argc, const char* argv) {
  while (true) {
    printf("y\n");
  }
}
```

#### yes.cpp

```cpp
#include <iostream>
using namespace std;

int main() {
  while (true) {
    cout << 'y' << endl;
  }
}
```

#### yes.rs

```rust
fn main() {
  loop {
    println!("y");
  }
}
```

#### yes.go

```go
package main
import "fmt"

func main() {
  for {
    fmt.Println("y")
  }
}
```

#### yes.pyx

```python
def main():
  while True:
    print("y")

if __name__ in "__main__":
  main()
```


# compileall.sh

We can use a simple script `compileall.sh` to compile all code into programs.

```bash
echo "# Go ###################################################################"
time go build -o yes_go -ldflags "-s -w" yes.go

echo "# Nim ##################################################################"
time nim c -d:danger --mm:arc --threads:off --verbosity:0 --passC:"-march=native" -o:yes_nim yes.nim

echo "# C ####################################################################"
time gcc -O3 -march=native -g yes.c -o yes_c

echo "# C++ ##################################################################"
time g++ -std=gnu++20 -O3 -march=native -g yes.cpp -o yes_cpp

echo "# Cython3 C ############################################################"
time cython3 -3 --embed --no-docstrings -o yes_temp.c yes.pyx
time gcc -O3 -march=native -I /usr/include/python3.10 -lpython3.10 -o yes_cyc yes_temp.c
rm yes_temp.c

echo "# Cython3 C++ ##########################################################"
time cython3 -3 --cplus --embed --no-docstrings -o yes_temp.cpp yes.pyx
time g++ -O3 -march=native -I /usr/include/python3.10 -lpython3.10 -o yes_cycpp yes_temp.cpp
rm yes_temp.cpp

echo "# Rust #################################################################"
time rustc -C opt-level=3 -C target-cpu=native -o yes_rust yes.rs

echo "# Filesizes ############################################################"
du -h yes_c
du -h yes_cpp
du -h yes_rust
du -h yes_nim
du -h yes_cyc
du -h yes_cycpp
du -h yes_go

echo "# LDD yes_nim ##########################################################"
ldd yes_nim

echo "# LDD yes_c ############################################################"
ldd yes_c

echo "# LDD yes_cpp ##########################################################"
ldd yes_cpp

echo "# LDD yes_cyc ##########################################################"
ldd yes_cyc

echo "# LDD yes_cycpp ########################################################"
ldd yes_cycpp

echo "# LDD yes_rust #########################################################"
ldd yes_rust

echo "# LDD yes_go ###########################################################"
ldd yes_go
```

The output should looks something similar to:

```
$ ./compileall.sh

# Go ###################################################################
real    0m0,283s
user    0m0,227s
sys     0m0,064s
# Nim ##################################################################
real    0m0,500s
user    0m0,504s
sys     0m0,030s
# C ####################################################################
real    0m0,075s
user    0m0,065s
sys     0m0,015s
# C++ ##################################################################
real    0m0,679s
user    0m0,601s
sys     0m0,078s
# Cython3 C ############################################################
real    0m0,533s
user    0m0,492s
sys     0m0,040s
real    0m0,624s
user    0m0,554s
sys     0m0,070s
# Cython3 C++ ##########################################################
real    0m0,497s
user    0m0,487s
sys     0m0,010s
real    0m1,015s
user    0m0,932s
sys     0m0,081s
# Rust #################################################################
real    0m0,460s
user    0m0,320s
sys     0m0,075s
# Filesizes ############################################################
24K     yes_c
44K     yes_cpp
8,8M    yes_rust
52K     yes_nim
40K     yes_cyc
40K     yes_cycpp
1,3M    yes_go
# LDD yes_nim ###########################################################
        linux-vdso.so.1 (0x00007ffeb10e1000)
        libc.so.6 => /usr/lib/libc.so.6 (0x00007fc89f063000)
        /lib64/ld-linux-x86-64.so.2 => /usr/lib64/ld-linux-x86-64.so.2 (0x00007fc89f287000)
# LDD yes_c #############################################################
        linux-vdso.so.1 (0x00007ffcdddfe000)
        libc.so.6 => /usr/lib/libc.so.6 (0x00007f50587c3000)
        /lib64/ld-linux-x86-64.so.2 => /usr/lib64/ld-linux-x86-64.so.2 (0x00007f50589df000)
# LDD yes_cpp ###########################################################
        linux-vdso.so.1 (0x00007fff69d94000)
        libstdc++.so.6 => /usr/lib/libstdc++.so.6 (0x00007f458c717000)
        libm.so.6 => /usr/lib/libm.so.6 (0x00007f458c62f000)
        libgcc_s.so.1 => /usr/lib/libgcc_s.so.1 (0x00007f458c60f000)
        libc.so.6 => /usr/lib/libc.so.6 (0x00007f458c428000)
        /lib64/ld-linux-x86-64.so.2 => /usr/lib64/ld-linux-x86-64.so.2 (0x00007f458c983000)
# LDD yes_cyc ############################################################
        linux-vdso.so.1 (0x00007ffe553fb000)
        libpython3.10.so.1.0 => /usr/lib/libpython3.10.so.1.0 (0x00007f0392875000)
        libc.so.6 => /usr/lib/libc.so.6 (0x00007f039268e000)
        libm.so.6 => /usr/lib/libm.so.6 (0x00007f03925a6000)
        /lib64/ld-linux-x86-64.so.2 => /usr/lib64/ld-linux-x86-64.so.2 (0x00007f0392c62000)
# LDD yes_cycpp ############################################################
        linux-vdso.so.1 (0x00007ffc5a7ca000)
        libpython3.10.so.1.0 => /usr/lib/libpython3.10.so.1.0 (0x00007fb324b27000)
        libstdc++.so.6 => /usr/lib/libstdc++.so.6 (0x00007fb3248f0000)
        libm.so.6 => /usr/lib/libm.so.6 (0x00007fb324808000)
        libgcc_s.so.1 => /usr/lib/libgcc_s.so.1 (0x00007fb3247e8000)
        libc.so.6 => /usr/lib/libc.so.6 (0x00007fb324601000)
        /lib64/ld-linux-x86-64.so.2 => /usr/lib64/ld-linux-x86-64.so.2 (0x00007fb324f14000)
# LDD yes_rust ##########################################################
        linux-vdso.so.1 (0x00007ffe31765000)
        libgcc_s.so.1 => /usr/lib/libgcc_s.so.1 (0x00007f718f9d2000)
        libc.so.6 => /usr/lib/libc.so.6 (0x00007f718f7eb000)
        /lib64/ld-linux-x86-64.so.2 => /usr/lib64/ld-linux-x86-64.so.2 (0x00007f718fa70000)
# LDD yes_go ############################################################
        not a dynamic executable
$
```


# Benchmarks

We can try running all executables using:

```bash
$ ./yes_c     | pv -r > /dev/null
$ ./yes_cpp   | pv -r > /dev/null
$ ./yes_cyc   | pv -r > /dev/null
$ ./yes_cycpp | pv -r > /dev/null
$ ./yes_rust  | pv -r > /dev/null
$ ./yes_go    | pv -r > /dev/null
$ ./yes_nim   | pv -r > /dev/null
```

- `CTRL + C` to stop.


# Results

The current results should be similar to:

| Lang        | Speed      |
|-------------|------------|
| Nim         | `180MiB/s` |
| C           | `80MiB/s`  |
| Cython3 C   | `6MiB/s`   |
| Cython3 C++ | `6MiB/s`   |
| C++         | `5,5MiB/s` |
| Rust        | `5MiB/s`   |
| Go          | `3,5MiB/s` |

- Try it yourself on your device, have fun!.


#### Notes

- No Macros, no emit ASM, no call-to-C directly, because not all languages have it.
- Continue reading https://nim-lang.org/blog/2018/01/22/yes-command-in-nim.html


-------

If you like this article and how we evolve Nim, please consider a donation. You can donate via:

- [Open Collective](https://opencollective.com/nim)
- [Patreon](https://www.patreon.com/araq)
- Bitcoin `1BXfuKM2uvoD6mbx4g5xM3eQhLzkCK77tJ`.
- Ethereum `0xC1d472B409c1bdCd8C0E45515D18F08a55fE9fa8`.

If you are a company, we also offer commercial support.
Please get in touch with us via [support@nim-lang.org](mailto:support@nim-lang.org).
As a commercial backer, you can decide what features and bugfixes should be prioritized.
